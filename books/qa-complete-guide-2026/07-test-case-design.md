---
title: "テストケース設計技法：効果的なテストの作り方"
---

# テストケース設計技法：効果的なテストの作り方

## テストケース設計技法とは

テストケース設計技法は、限られた時間とリソースで最大限の品質保証を実現するための体系的な方法論です。闇雲にテストするのではなく、科学的なアプローチでテストケースを設計することで、効率と網羅性を両立します。

## 1. 同値分割法（Equivalence Partitioning）

入力値の範囲を「同じように振る舞う」グループに分割し、各グループから代表値をテストする技法です。

### 基本的な考え方

すべての入力値をテストすることは現実的でないため、同じ結果を返すと期待される値をグループ化し、各グループから1つずつテストします。

### 例：年齢入力のテスト

```
仕様: 年齢は0〜150の整数

同値分割:
- 有効クラス: 0〜150
- 無効クラス1: 負の数
- 無効クラス2: 151以上
- 無効クラス3: 小数
- 無効クラス4: 文字列
```

| テストケース | 入力値 | 期待結果 | クラス |
|------------|--------|---------|--------|
| TC01 | 25 | OK | 有効 |
| TC02 | -1 | エラー | 無効1 |
| TC03 | 200 | エラー | 無効2 |
| TC04 | 25.5 | エラー | 無効3 |
| TC05 | "abc" | エラー | 無効4 |

### 適用例：割引率計算

```typescript
// 購入金額による割引率
// 10,000円未満: 0%
// 10,000〜29,999円: 5%
// 30,000〜49,999円: 10%
// 50,000円以上: 15%

// 同値クラス
const testCases = [
  { amount: 5000, expectedDiscount: 0 },    // 第1クラス
  { amount: 15000, expectedDiscount: 5 },   // 第2クラス
  { amount: 35000, expectedDiscount: 10 },  // 第3クラス
  { amount: 60000, expectedDiscount: 15 },  // 第4クラス
];
```

## 2. 境界値分析（Boundary Value Analysis）

同値分割の境界付近の値を重点的にテストする技法です。バグは境界付近で発生しやすいという経験則に基づきます。

### 基本ルール

各境界に対して以下の値をテストします：
- 境界値（境界そのもの）
- 境界値-1（境界の直前）
- 境界値+1（境界の直後）

### 例：年齢入力の境界値テスト

```
仕様: 年齢は0〜150の整数

境界値:
- 下限: 0
- 上限: 150
```

| テストケース | 入力値 | 期待結果 | 説明 |
|------------|--------|---------|------|
| TC01 | -1 | エラー | 下限-1 |
| TC02 | 0 | OK | 下限 |
| TC03 | 1 | OK | 下限+1 |
| TC04 | 149 | OK | 上限-1 |
| TC05 | 150 | OK | 上限 |
| TC06 | 151 | エラー | 上限+1 |

### 実装例：境界値テスト

```typescript
describe('Age Validation', () => {
  test.each([
    [-1, false, 'lower boundary - 1'],
    [0, true, 'lower boundary'],
    [1, true, 'lower boundary + 1'],
    [149, true, 'upper boundary - 1'],
    [150, true, 'upper boundary'],
    [151, false, 'upper boundary + 1'],
  ])('age %i should be %s (%s)', (age, expected, description) => {
    expect(isValidAge(age)).toBe(expected);
  });
});
```

## 3. デシジョンテーブル（Decision Table）

複数の条件の組み合わせを網羅的にテストする技法です。複雑なビジネスロジックのテストに有効です。

### 例：ログインテスト

```
条件:
- ユーザーID: 正しい / 誤り
- パスワード: 正しい / 誤り
- アカウント状態: 有効 / 無効
```

| ケース | UserID | Password | Status | 期待結果 |
|-------|--------|----------|--------|---------|
| 1 | ○ | ○ | 有効 | ログイン成功 |
| 2 | ○ | ○ | 無効 | アカウント無効エラー |
| 3 | ○ | × | 有効 | パスワードエラー |
| 4 | ○ | × | 無効 | パスワードエラー |
| 5 | × | ○ | 有効 | ユーザーIDエラー |
| 6 | × | ○ | 無効 | ユーザーIDエラー |
| 7 | × | × | 有効 | ユーザーIDエラー |
| 8 | × | × | 無効 | ユーザーIDエラー |

### 簡略化（縮約）

すべての組み合わせをテストする必要がない場合、重要な組み合わせに絞ります：

| ケース | UserID | Password | Status | 期待結果 |
|-------|--------|----------|--------|---------|
| 1 | ○ | ○ | 有効 | ログイン成功 |
| 2 | ○ | ○ | 無効 | アカウント無効エラー |
| 3 | ○ | × | - | パスワードエラー |
| 4 | × | - | - | ユーザーIDエラー |

## 4. 状態遷移テスト（State Transition Testing）

システムの状態変化をテストする技法です。状態遷移図を作成し、網羅的にテストします。

### 例：注文ステータス

```
状態:
- 未払い → 支払い済み → 発送済み → 配達完了
              ↓
           キャンセル
```

### 状態遷移テーブル

| 現在の状態 | イベント | 次の状態 | テスト済み |
|----------|---------|---------|-----------|
| 未払い | 支払い | 支払い済み | ✓ |
| 未払い | キャンセル | キャンセル | ✓ |
| 支払い済み | 発送 | 発送済み | ✓ |
| 支払い済み | キャンセル | キャンセル | ✓ |
| 発送済み | 配達 | 配達完了 | ✓ |

### 無効な遷移もテスト

| 現在の状態 | イベント | 期待結果 |
|----------|---------|---------|
| 配達完了 | 発送 | エラー |
| キャンセル | 支払い | エラー |

## 5. ペアワイズ法（Pairwise Testing）

多数のパラメータの組み合わせを効率的にテストする技法です。すべての2つのパラメータの組み合わせを最低1回はカバーします。

### 例：ブラウザ互換性テスト

```
パラメータ:
- OS: Windows, macOS, Linux
- Browser: Chrome, Firefox, Safari
- Version: Latest, Previous
```

全組み合わせ: 3 × 3 × 2 = 18通り

ペアワイズ: 9通り程度に削減可能

| ケース | OS | Browser | Version |
|-------|-----|---------|---------|
| 1 | Windows | Chrome | Latest |
| 2 | Windows | Firefox | Previous |
| 3 | Windows | Safari | Latest |
| 4 | macOS | Chrome | Previous |
| 5 | macOS | Firefox | Latest |
| 6 | macOS | Safari | Previous |
| 7 | Linux | Chrome | Latest |
| 8 | Linux | Firefox | Previous |
| 9 | Linux | Safari | Latest |

### ペアワイズツール

- PICT（Microsoft製）
- AllPairs
- CTE XL（オンラインツール）

## 6. エラー推測（Error Guessing）

テスターの経験と勘に基づいてエラーが発生しそうな箇所をテストする技法です。

### よくあるエラーパターン

**境界値エラー**
- 0, 空文字, null, undefined
- 配列の最初と最後
- 最大値、最小値

**型エラー**
- 数値に文字列を入力
- 期待しない型のデータ

**タイミングエラー**
- 連打（ダブルクリック）
- タイムアウト
- 同時実行

**セキュリティ関連**
- SQLインジェクション
- XSS
- CSRF

### 実例：入力フォームのエラー推測

```typescript
// 典型的なエラーケース
const errorCases = [
  { input: '', error: '必須エラー' },
  { input: ' ', error: '空白のみ' },
  { input: '<script>alert(1)</script>', error: 'XSS' },
  { input: "'; DROP TABLE users; --", error: 'SQLインジェクション' },
  { input: 'a'.repeat(256), error: '最大長超過' },
  { input: '😀😀😀', error: '絵文字' },
];
```

## 7. ユースケーステスト

実際のユーザーシナリオに基づいてテストする技法です。

### 例：ECサイトの購入フロー

```markdown
## メインシナリオ

1. ユーザーがサイトにアクセス
2. 商品を検索
3. 商品詳細を閲覧
4. カートに追加
5. カートを確認
6. 配送先情報を入力
7. 支払い方法を選択
8. 注文確定
9. 注文完了メール受信

## 代替シナリオ

- 2a. 検索結果が0件 → おすすめ商品を表示
- 5a. クーポンコード入力 → 割引適用
- 7a. 支払い失敗 → エラーメッセージ表示

## 例外シナリオ

- 在庫切れ商品をカートに追加
- セッションタイムアウト
- ネットワークエラー
```

## テストケース設計のベストプラクティス

### 1. 技法を組み合わせる

単一の技法ではなく、複数を組み合わせて使用します。

```
決済金額テスト:
- 同値分割: 割引率のクラス分け
- 境界値分析: 割引率の境界値
- エラー推測: 負の値、巨大な値
- ユースケース: 実際の購入シナリオ
```

### 2. 優先順位をつける

リスクベースでテストケースに優先順位をつけます。

| 優先度 | 対象 | 実行タイミング |
|-------|------|-------------|
| P0 | Critical path | 毎ビルド |
| P1 | 重要機能 | 毎日 |
| P2 | 通常機能 | 週次 |
| P3 | 低頻度機能 | リリース前 |

### 3. 保守性を考慮

テストケースは保守コストを考慮して設計します。

```typescript
// 悪い例: マジックナンバー
expect(result).toBe(15000);

// 良い例: 意味のある定数
const DISCOUNT_RATE = 0.1;
const ORIGINAL_PRICE = 150000;
const EXPECTED_PRICE = ORIGINAL_PRICE * (1 - DISCOUNT_RATE);
expect(result).toBe(EXPECTED_PRICE);
```

### 4. データドリブンテスト

同じロジックで異なるデータをテストする場合、データドリブンテストを活用します。

```typescript
test.each([
  [0, 0],
  [9999, 0],
  [10000, 500],
  [29999, 1499],
  [30000, 3000],
  [50000, 7500],
])('calculateDiscount(%i) returns %i', (amount, expected) => {
  expect(calculateDiscount(amount)).toBe(expected);
});
```

## テストケース管理

### テストケースのフォーマット

```markdown
## TC-001: ログイン成功

**前提条件**:
- 有効なユーザーアカウントが存在する
- ログアウト状態

**テスト手順**:
1. ログインページにアクセス
2. ユーザーID "test@example.com" を入力
3. パスワード "password123" を入力
4. "ログイン" ボタンをクリック

**期待結果**:
- ダッシュボード画面が表示される
- ヘッダーにユーザー名が表示される
- URL が /dashboard に遷移する

**実行結果**: PASS
**実行者**: 山田
**実行日**: 2026-03-01
```

## まとめ

テストケース設計技法を習得することで、効率的かつ網羅的なテストが期待されます。同値分割、境界値分析、デシジョンテーブル、状態遷移テスト、ペアワイズ法など、状況に応じて適切な技法を選択することが重要です。

また、技法は組み合わせて使用し、リスクベースで優先順位をつけることで、限られたリソースで最大の効果を発揮できます。

次章では、探索的テストの実践方法について解説します。

