# Zenn デプロイメント注意事項

## ⚠️ 重要: Zennのデプロイ仕組みと注意点

### 問題: 古いコミットで書いた章がZennに反映されない

**発生日**: 2026年1月5日

**症状**:
- ローカルファイルには完全な内容（700-1500行）が存在する
- GitHubにも正しくプッシュ済み（`git diff origin/main`で差分なし）
- しかし**Zennの表示では「執筆中」のスケルトン（300-400字）のまま**

**原因**:
Zennは**最新のコミットで変更されたファイルのみ**をデプロイする仕組みになっている。

例:
```bash
# コミット履歴
c59ce05 - Chapter 06を完全に執筆（728行）
1ce40ff - Chapter 07-09を執筆（Chapter 06は変更なし）
35fb9ad - 空コミット（Chapter 06は変更なし）

# この場合、Zennは：
# - Chapter 07-09: 最新コミット1ce40ffで変更 → デプロイされる ✅
# - Chapter 06: 最新コミットで変更なし → デプロイされない ❌（古いスケルトンが残る）
```

**実際のデプロイログ**:
```
デプロイ成功
3ファイルの更新
books/react-development-2026-official/03-typescript-patterns.md
books/react-development-2026-official/04-optimization-performance.md
books/react-development-2026-official/05-nextjs-app-router.md
```
→ Chapter 06は含まれていない = Zennは更新を検知していない

---

## ✅ 解決方法

### 方法1: ファイルを少し編集して再コミット（推奨）

```bash
# 該当チャプターに小さな変更を加える（例: 難易度表示を追加）
# books/react-development-2026-official/06-rendering-optimization.md

**所要時間**: 70-90分
**難易度**: ★★★☆☆（中級）  # ← この行を追加

# コミット・プッシュ
git add books/react-development-2026-official/06-rendering-optimization.md
git commit -m "fix: Force re-deploy of Chapter 06 to Zenn"
git push origin main
```

### 方法2: 全チャプターを一度にコミット

複数チャプターを同時に執筆した場合は、**必ず全てを同じコミットに含める**:

```bash
# ❌ 悪い例: 個別にコミット
git add 06-*.md && git commit -m "Add Chapter 06"
git add 07-*.md && git commit -m "Add Chapter 07"
git add 08-*.md && git commit -m "Add Chapter 08"
# → 後から修正が入った場合、古いチャプターが反映されないリスク

# ✅ 良い例: 関連チャプターをまとめてコミット
git add 06-*.md 07-*.md 08-*.md 09-*.md
git commit -m "feat: Add Chapters 06-09 (Complete)"
git push origin main
# → 一度のコミットで全て反映される
```

### 方法3: `touch`コマンドでタイムスタンプ更新（効果なし）

```bash
# ❌ これは効果がない
touch books/react-development-2026-official/06-*.md
git add books/react-development-2026-official/06-*.md
# → gitは内容の変更を検知しないため、コミットできない
```

---

## 📋 執筆時のチェックリスト

### 新しいチャプターを執筆する時

- [ ] 執筆完了後、**即座にコミット・プッシュ**する
- [ ] 複数チャプターを同時に執筆した場合、**全てを同じコミットに含める**
- [ ] プッシュ後、**Zennのデプロイログを確認**して該当ファイルが含まれているか確認

### Zennの表示を確認する時

- [ ] プッシュから**3-5分待つ**（Zennの同期に時間がかかる）
- [ ] Zennダッシュボードで「デプロイ履歴」を確認
- [ ] デプロイされたファイル一覧に該当チャプターが含まれているか確認
- [ ] 文字数が想定通りか確認（目安: 1万字以上）

### トラブルシューティング

もし「執筆中」のままの場合:

1. **ローカルファイルを確認**:
   ```bash
   wc -l books/react-development-2026-official/06-*.md
   # 出力: 728行なら内容は存在
   ```

2. **GitHubとの差分を確認**:
   ```bash
   git diff origin/main books/react-development-2026-official/06-*.md
   # 出力なし = プッシュ済み
   ```

3. **最終コミットを確認**:
   ```bash
   git log --oneline -- books/react-development-2026-official/06-*.md
   # 最新のコミットがいつか確認
   ```

4. **強制的に再デプロイ**:
   - ファイルに小さな変更を加える（難易度追加、改行追加など）
   - 再度コミット・プッシュ

---

## 🎯 ベストプラクティス

### 推奨ワークフロー

```bash
# 1. チャプター執筆
# ... 執筆作業 ...

# 2. 即座にコミット（執筆完了後すぐ）
git add books/react-development-2026-official/06-*.md
git commit -m "feat: Add Chapter 06 (Rendering Optimization)"
git push origin main

# 3. Zennデプロイ確認（3-5分後）
# Zennダッシュボード → デプロイ履歴 → ファイル一覧を確認

# 4. 問題があれば即座に対処
# 小さな変更を加えて再プッシュ
```

### 複数チャプター執筆時

```bash
# ✅ 推奨: 全チャプター完成後に一括コミット
git add books/react-development-2026-official/{06,07,08,09}-*.md
git commit -m "feat: Add Chapters 06-09 (Complete)"
git push origin main
```

---

## 📝 過去の事例

### 事例1: Chapter 06-09が反映されない（2026年1月5日）

**状況**:
- Chapter 06をコミット`c59ce05`で執筆（728行）
- その後、Chapter 07-09をコミット`1ce40ff`で執筆
- Chapter 06は変更していないため、Zennに反映されず

**解決**:
- Chapter 06-09に難易度表示を追加
- コミット`cede42a`で再プッシュ
- Zennに正しく反映された

**学んだこと**:
- **一度にまとめてコミットする**重要性
- **Zennは差分デプロイ**であることの理解
- **デプロイログの確認**を習慣化

---

## 🔍 デバッグコマンド集

```bash
# ファイルの行数確認
wc -l books/react-development-2026-official/*.md

# 文字数確認
wc -m books/react-development-2026-official/06-*.md

# 最終更新コミット確認
git log -1 --oneline -- books/react-development-2026-official/06-*.md

# リモートとの差分確認
git diff origin/main books/react-development-2026-official/06-*.md

# 全チャプターの状態確認
for chapter in {00..09}; do
  echo "Chapter $chapter:"
  wc -l books/react-development-2026-official/${chapter}-*.md 2>/dev/null || echo "  Not found"
done
```

---

## ⚡ クイックリファレンス

| 症状 | 原因 | 解決方法 |
|------|------|----------|
| Zennに反映されない | 最新コミットで変更なし | ファイルを少し編集して再プッシュ |
| 文字数が少ない（300-400字） | スケルトンのまま | 完全な内容を書いて再プッシュ |
| デプロイされていない | ファイル名がconfig.yamlにない | config.yamlに追加 |
| 「執筆中」のまま | 古いバージョンがキャッシュ | 3-5分待つ、またはファイル編集して再プッシュ |

---

**最終更新**: 2026年1月5日
**作成者**: Claude Code
